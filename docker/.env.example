################################################################################
# Baram Naver News Crawler - Environment Variables
# Copyright (c) 2024 hephaex@gmail.com
# License: GPL v3
#
# ⚠️  SECURITY WARNING ⚠️
# This file contains SENSITIVE CONFIGURATION. DO NOT commit the actual .env
# file to version control. Use .env.example only as a template.
#
# INSTRUCTIONS:
# 1. Copy .env.example to .env
# 2. Replace all placeholder values with actual secure values
# 3. Use strong, randomly generated passwords (min 32 chars for secrets)
# 4. Ensure .env is added to .gitignore (already configured)
# 5. Restrict file permissions: chmod 600 .env
# 6. Never share or expose .env contents in logs, debugging, or reports
#
# For production deployments, use a secrets management system:
# - AWS Secrets Manager
# - HashiCorp Vault
# - Kubernetes Secrets
# - Docker Secrets (Swarm mode)
################################################################################

# ============================================================================
# DEPLOYMENT ENVIRONMENT
# ============================================================================
# Set to: production, staging, or development
# Default: development
ENVIRONMENT=development

# ============================================================================
# PostgreSQL Configuration
# ============================================================================
POSTGRES_DB=baram
POSTGRES_USER=baram
# SECURITY: Generate strong password with: openssl rand -base64 32
# Minimum requirements: 32 characters, mixed case, numbers, special chars
POSTGRES_PASSWORD=YOUR_SECURE_POSTGRES_PASSWORD_HERE
POSTGRES_PORT=5432

# PostgreSQL connection string (used by Rust application)
# NOTE: Update password to match POSTGRES_PASSWORD above
DATABASE_URL=postgresql://baram:YOUR_SECURE_POSTGRES_PASSWORD_HERE@localhost:5432/baram

# Connection pool settings
DB_POOL_MAX_SIZE=20
DB_POOL_MIN_IDLE=5
DB_POOL_TIMEOUT_SECONDS=30

# ============================================================================
# OpenSearch Configuration
# ============================================================================
# SECURITY: Generate strong password with: openssl rand -base64 32
# Minimum requirements: 32 characters, uppercase, lowercase, numbers, special chars
OPENSEARCH_INITIAL_ADMIN_PASSWORD=YOUR_SECURE_OPENSEARCH_PASSWORD_HERE

# OpenSearch ports
OPENSEARCH_PORT=9200
OPENSEARCH_PERF_PORT=9600

# Security settings
# SECURITY: Keep false in production, enable security module and update passwords
OPENSEARCH_SECURITY_DISABLED=false

# OpenSearch connection (used by Rust application)
OPENSEARCH_URL=http://localhost:9200
OPENSEARCH_USERNAME=admin
OPENSEARCH_PASSWORD=YOUR_SECURE_OPENSEARCH_PASSWORD_HERE

# Index settings
OPENSEARCH_INDEX_NAME=naver-news
OPENSEARCH_BULK_SIZE=100
OPENSEARCH_TIMEOUT_SECONDS=30

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_PORT=6379
REDIS_MAXMEMORY=256mb

# Redis connection (used by Rust application)
REDIS_URL=redis://localhost:6379
REDIS_DB=0

# Connection pool
REDIS_POOL_MAX_SIZE=10
REDIS_POOL_TIMEOUT_SECONDS=5

# ============================================================================
# Development Tools (Optional - only start with --profile development)
# ============================================================================
# OpenSearch Dashboards
OPENSEARCH_DASHBOARDS_PORT=5601

# pgAdmin
PGADMIN_PORT=5050
PGADMIN_EMAIL=admin@baram.local
# SECURITY: Change to a strong password for pgAdmin
PGADMIN_PASSWORD=YOUR_SECURE_PGADMIN_PASSWORD_HERE

# Grafana (optional monitoring)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=YOUR_SECURE_GRAFANA_PASSWORD_HERE
GRAFANA_PORT=3000

# Prometheus (optional metrics collection)
PROMETHEUS_PORT=9090

# ============================================================================
# Crawler Configuration
# ============================================================================
# Crawler service logging
CRAWLER_LOG_LEVEL=info

# Rate limiting (requests per second)
CRAWLER_REQUESTS_PER_SECOND=2
CRAWLER_MAX_RETRIES=3
CRAWLER_TIMEOUT_SECONDS=30

# User-Agent rotation
CRAWLER_USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

# Crawl limits
CRAWLER_MAX_ARTICLES_PER_RUN=1000
CRAWLER_MAX_COMMENTS_PER_ARTICLE=500

# Checkpoint directory
CRAWLER_CHECKPOINT_DIR=./checkpoints

# ============================================================================
# Distributed Mode Configuration
# ============================================================================
# Enable distributed crawling across multiple instances
FEATURE_DISTRIBUTED_CRAWLING=false

# Coordinator service logging
COORDINATOR_LOG_LEVEL=info

# Heartbeat interval for instance health checks (seconds)
HEARTBEAT_TIMEOUT=30

# Maximum number of concurrent crawler instances in distributed mode
MAX_INSTANCES=10

# ============================================================================
# Storage Configuration
# ============================================================================
# Output directories
OUTPUT_DIR=./output
OUTPUT_RAW_DIR=./output/raw
OUTPUT_MARKDOWN_DIR=./output/markdown

# SQLite database (for local metadata)
SQLITE_DB_PATH=./baram.db

# ============================================================================
# Embedding Configuration
# ============================================================================
# Model settings
EMBEDDING_MODEL_NAME=intfloat/multilingual-e5-large
EMBEDDING_DIMENSION=1024
EMBEDDING_BATCH_SIZE=32

# Chunking settings
CHUNK_SIZE=512
CHUNK_OVERLAP=50

# Model cache directory
HF_HOME=./models
TRANSFORMERS_CACHE=./models/transformers

# ============================================================================
# LLM Configuration (for Ontology Extraction)
# ============================================================================
# Choose LLM provider: openai, gemini, local, ollama
LLM_PROVIDER=ollama

# OpenAI settings (required only if using OpenAI)
# SECURITY: Use environment-specific API keys, never commit real keys
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE
OPENAI_MODEL=gpt-4-turbo
OPENAI_MAX_TOKENS=2000

# Ollama settings (local)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3:8b

# LLM retry settings
LLM_MAX_RETRIES=3
LLM_TIMEOUT_SECONDS=60

# ============================================================================
# Logging Configuration
# ============================================================================
# Log level: trace, debug, info, warn, error
RUST_LOG=info,baram=debug

# Log format: json, pretty
LOG_FORMAT=pretty

# Log output
LOG_FILE=./logs/baram.log

# ============================================================================
# Monitoring and Metrics
# ============================================================================
# Prometheus metrics endpoint
METRICS_ENABLED=false
METRICS_PORT=9090

# Health check endpoint
HEALTH_CHECK_PORT=8080

# ============================================================================
# Feature Flags
# ============================================================================
# Enable/disable specific features
FEATURE_COMMENTS_ENABLED=true
FEATURE_ONTOLOGY_ENABLED=true
FEATURE_VECTOR_SEARCH_ENABLED=true

# ============================================================================
# Performance Tuning
# ============================================================================
# Tokio runtime threads (0 = auto-detect)
TOKIO_WORKER_THREADS=0

# Channel buffer sizes
CHANNEL_BUFFER_SIZE=1000

# Batch processing
BATCH_SIZE=100

# ============================================================================
# Security and Privacy
# ============================================================================
# Content sanitization
SANITIZE_HTML=true
REMOVE_SCRIPTS=true
REMOVE_STYLES=false

# Personal information masking
MASK_USER_IDS=true
MASK_EMAIL=true
MASK_PHONE=true

# ============================================================================
# Network Configuration
# ============================================================================
# Proxy settings (optional)
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1

# DNS settings
DNS_TIMEOUT_SECONDS=5

# Connection settings
TCP_KEEPALIVE_SECONDS=60
CONNECTION_TIMEOUT_SECONDS=10

# ============================================================================
# Error Handling
# ============================================================================
# Retry configuration
RETRY_INITIAL_INTERVAL_MS=1000
RETRY_MAX_INTERVAL_MS=60000
RETRY_MULTIPLIER=2.0
RETRY_RANDOMIZATION_FACTOR=0.1

# Circuit breaker
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT_SECONDS=60

# ============================================================================
# Development Settings
# ============================================================================
# Development mode (enables debug features)
# SECURITY: Set to false in production, true only for local development
DEV_MODE=false

# Mock external services (for testing)
# SECURITY: Set to false in production
MOCK_NAVER_API=false

# Seed for reproducible testing
RANDOM_SEED=42

# ============================================================================
# Production Settings
# ============================================================================
# Sentry error tracking (optional)
SENTRY_DSN=

# Application version
APP_VERSION=0.1.0

# ============================================================================
# PRODUCTION DEPLOYMENT SECURITY CHECKLIST
# ============================================================================
# CRITICAL: Before deploying to production, complete all items below:
#
# SECRETS & CREDENTIALS:
# [ ] Replace all YOUR_SECURE_* placeholders with actual strong passwords
# [ ] Generate secrets using: openssl rand -base64 32
# [ ] Use a secrets management system (Vault, AWS Secrets Manager, etc.)
# [ ] Rotate all credentials before going live
# [ ] Store .env in secure vault, never in git
#
# NETWORK & INFRASTRUCTURE:
# [ ] Enable SSL/TLS for all services with valid certificates
# [ ] Configure firewalls to restrict access to necessary ports only
# [ ] Set up network policies for pod-to-pod communication (K8s)
# [ ] Enable VPC/subnet security groups
# [ ] Configure DDoS protection
# [ ] Use private subnets for databases
#
# DEPLOYMENT SETTINGS:
# [ ] Set ENVIRONMENT=production
# [ ] Set DEV_MODE=false
# [ ] Set MOCK_NAVER_API=false
# [ ] Disable OPENSEARCH_SECURITY_DISABLED (keep as false)
#
# MONITORING & LOGGING:
# [ ] Configure Sentry DSN for error tracking
# [ ] Enable Prometheus metrics (METRICS_ENABLED=true)
# [ ] Set up log aggregation (ELK, Splunk, DataDog, etc.)
# [ ] Configure alerting for critical metrics
# [ ] Enable audit logging for all services
# [ ] Set up log rotation and retention policies
#
# DATABASE & BACKUP:
# [ ] Configure automated backups with retention policies
# [ ] Test backup recovery procedures
# [ ] Enable PostgreSQL SSL connections
# [ ] Set up Point-in-Time Recovery (PITR)
# [ ] Restrict database access to application only
#
# APPLICATION SECURITY:
# [ ] Enable rate limiting (review CRAWLER_REQUESTS_PER_SECOND)
# [ ] Configure CORS properly
# [ ] Enable CSRF protection
# [ ] Use security headers (HSTS, CSP, X-Frame-Options)
# [ ] Implement request signing/verification
# [ ] Enable content security policy
#
# ACCESS CONTROL:
# [ ] Implement RBAC for application users
# [ ] Set up MFA for admin accounts
# [ ] Restrict SSH/console access to authorized IPs
# [ ] Configure service account permissions
# [ ] Enable audit logging for access attempts
#
# COMPLIANCE & MAINTENANCE:
# [ ] Document security policies and procedures
# [ ] Conduct security code review
# [ ] Perform penetration testing
# [ ] Set up regular security updates
# [ ] Schedule vulnerability scanning
# [ ] Document incident response procedures
# [ ] Train team on security best practices
